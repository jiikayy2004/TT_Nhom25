<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng nhập — GymKayy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">
                <div class="logo-icon">920</div>
                <div class="logo-text">Gym<span>Kayy</span></div>
            </a>
            <ul class="nav-menu">
                <li><a href="index.html">Trang chủ</a></li>
                <li><a href="register.html">Đăng ký</a></li>
                <li><a href="login.html" class="active">Đăng nhập</a></li>
            </ul>
        </nav>
    </header>

    <main style="margin-top:110px;">
        <section style="display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 140px);padding:40px;">
            <div class="package-card" style="max-width:440px;width:100%;">
                <h2 style="text-align:center;margin-bottom:18px;font-size:22px;">Đăng Nhập Hệ Thống</h2>

                <form id="loginForm">
                    <div style="margin-bottom:14px;">
                        <label class="form-label" style="display:block;margin-bottom:6px;font-weight:600;color:#cfcfcf;">Email đăng nhập</label>
                        <input type="email" id="email" placeholder="Nhập email của bạn..." required style="width:100%;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;">
                    </div>

                    <div style="margin-bottom:6px;">
                        <label class="form-label" style="display:block;margin-bottom:6px;font-weight:600;color:#cfcfcf;">Mật khẩu</label>
                        <input type="password" id="password" placeholder="Nhập mật khẩu..." required style="width:100%;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;">
                    </div>

                    <div style="margin-top:18px;">
                        <button type="submit" id="btnSubmit" class="btn-primary btn-login" style="width:100%;">ĐĂNG NHẬP</button>
                    </div>
                </form>

                <div id="result" style="display:none;margin-top:12px;color:#ff6b6b;"></div>
            </div>
        </section>
    </main>

    <footer style="margin-top:40px;">
        <!-- minimal footer to keep consistent look -->
        <div style="max-width:1200px;margin:0 auto;padding:20px;color:#808080;text-align:center;">© 2025 GymKayy</div>
    </footer>

    <script>
        const loginForm = document.getElementById('loginForm');
        const resultDiv = document.getElementById('result');
        const btnSubmit = document.getElementById('btnSubmit');
        
        
        loginForm.addEventListener('submit', async function(event) {
            // 1. Chặn hành động load lại trang mặc định của form
            event.preventDefault(); 
            
            // 2. Lấy dữ liệu người dùng nhập
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // Hiển thị trạng thái đang xử lý
            btnSubmit.innerText = "Đang xử lý...";
            btnSubmit.disabled = true;
            resultDiv.style.display = 'none';

            try {
                // 3. GỌI API (Fetch)
                // Lưu ý: Đường dẫn phải đúng với server WAMP của bạn
                const response = await fetch('http://localhost/QLPG/public/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: email, 
                        password: password 
                    })
                });

                // 4. Đọc dữ liệu trả về từ Laravel
                const data = await response.json();
                

                // 5. Kiểm tra kết quả
                resultDiv.style.display = 'block';
                
                if (response.ok && data.status) {
                    
                    alert("✅ Đăng nhập thành công!");
                    
                    // Lưu Token & User info
                    localStorage.setItem('gym_token', data.access_token); // Hoặc data.token tùy API
                    localStorage.setItem('gym_user', JSON.stringify(data.data)); // Hoặc data.user tùy API

                    // --- PHÂN LUỒNG ĐIỀU HƯỚNG ---
                    const role = data.data.role; // Lấy role của user

                    if (role === 'admin') {
                        // 1. Admin -> Vào Dashboard Admin
                        window.location.href = 'pages/admin/dashboard.html';
                    } 
                    else if (role === 'pt') {
                        // 2. PT -> Vào Dashboard PT (MỚI)
                        window.location.href = 'pages/pt/dashboard.html';
                    } 
                    else {
                        // 3. Khách hàng -> Về Trang chủ
                        window.location.href = 'index.html';
                    }
                } else {
                    // --- THẤT BẠI ---
                    resultDiv.className = 'error';
                    resultDiv.innerText = "❌ Lỗi: " + (data.message || "Đăng nhập thất bại");
                }

            } catch (error) {
                // Lỗi mạng hoặc server sập
                resultDiv.style.display = 'block';
                resultDiv.className = 'error';
                resultDiv.innerText = "❌ Lỗi kết nối tới Server API! (Kiểm tra lại WAMP)";
                console.error(error);
            } finally {
                // Trả lại nút bấm bình thường
                btnSubmit.innerText = "Đăng Nhập";
                btnSubmit.disabled = false;
            }
        });
        
        
    </script>
</body>
</html>